---
title: "R Notebook"
output: html_notebook
---

```{r}
library("readr")
library("dplyr")
library("ggplot2")
library("reticulate")
library("purrr")
library("reshape2")
```


```{r}
np <- import("numpy")
#layer_1 <- np$load("/Users/kris/Desktop/data/scratch/condor/dir_21852/stability_data/cnn/features/layer_1_best.npy")
layer_3 <- np$load("/Users/kris/Desktop/data/scratch/condor/dir_21852/stability_data/cnn/features/layer_3_best.npy")
final_layer <- np$load("/Users/kris/Desktop/data/scratch/condor/dir_21852/stability_data/cnn/features/linear_best.npy")
```

```{r}
layer_df <- melt(layer_3, varnames = c("sample", "feature", "spatial_x", "spatial_y"))
linear_df <- melt(final_layer, varnames = c("sample", "feature", "spatial_x", "spatial_y"))
```

Let's visualize a few of the activations, across their spatial dimensions.

```{r}
ggplot(layer_df %>% filter(sample  < 5, feature < 5)) +
  geom_tile(aes(x = as.factor(spatial_x), y = as.factor(spatial_y), fill = value)) +
  scale_fill_continuous(low = "white", high = "black") +
  facet_grid(sample ~ feature)
```

```{r}
linear_mat <- linear_df %>%
  dcast(sample ~ feature, value.var = "value") %>%
  select(-sample) %>%
  as.matrix()
heatmap(linear_mat)
```

