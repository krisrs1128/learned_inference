---
title: Recovery ability
---

```{r}
library("ggplot2")
library("readr")
library("dplyr")
library("stringr")
library("png")
library("glmnet")
```


```{r}
data_dir <- file.path("..", "data")
z <- read_csv(file.path(data_dir, "features", "vae_2020711", "features.csv")) %>%
  select(-X1) %>%
  select(path, everything())
y <- z$y
x <- z[, 2:101]

plot(z[[13]], y)
hist(cor(x, y), 20)

y[y > 6] <- 6
cv_res <- cv.glmnet(as.matrix(x), y)
plot(cv_res)

fit <- glmnet(as.matrix(x), y)
plot(fit)
plot(y, predict(fit, newx=as.matrix(x))[, 100], asp = 1, ylab="y_hat")
```

```{r}
png_paths <- gsub("npy", "png", z$path)
png_paths <- gsub("train", "pngs", png_paths)
png_paths <- paste0("../", png_paths)

ims <- lapply(png_paths, readPNG)
coords <- cmdscale(dist(x))
plot(coords)
```


```{r}
xgrid <- seq(-4, 6, by=0.5)
xgrid <- expand.grid(xgrid, xgrid)

plot_data <- list()
for (i in seq_len(nrow(xgrid))) {
  min_ix <- which.min(proxy::dist(xgrid[i, ], coords))
  plot_data[[i]] <- list(
    x = xgrid[i, 1],
    y = xgrid[i, 2],
    ims = ims[[min_ix]]
  )
}

height <- 2.4
width <- 2.4

plot(xgrid, t="n", asp = 1)
for (i in seq_len(nrow(xgrid))){
  rasterImage(
    ims[[i]],
    xleft = plot_data[[i]]$x - 0.1 * width,
    ybottom = plot_data[[i]]$y - 0.1 * height,
    xright = plot_data[[i]]$x + 0.1 * width,
    ytop = plot_data[[i]]$y + 0.1 * height,
    interpolate = FALSE
  )
}

```
