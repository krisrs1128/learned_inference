
\section{Materials and Methods}

Our high-level approach to feature stability analysis is given in Algorithms \ref{alg:features} through \ref{alg:selection}.

\begin{algorithm}[H]
\SetAlgoLined
\KwResult{Sets of learned features $\mathbf{Z}_{b}$ for $\mathcal{D}$. Indices
  $I\subset\left[n\right]$ used for feature learning.}
Inputs: Dataset $\mathcal{D} = \left(x_{i}, y_{i}\right)_{i = 1}^{n}$. Candidate
feature learners $\{T\left(\cdot; \theta\right)\}_{\theta \in \Theta}$ and
training criterion $\mathcal{L}$. Perturbation process $\mathcal{P}$.

1. Randomly split samples into disjoint subsets $I, I^{C} \subset \left[n\right]$.

2. Generate $B$ perturbed datasets,

\For{$b = 1, \dots, B$}{
	$\mathcal{D}_{b} \sim \mathcal{P}\left(\mathcal{D}\left[I\right]\right)$
}

3. Train $B$ feature learners,

\For{$b = 1, \dots, B$}{
  $\hat{\theta}\left(\mathcal{D}_{b}\right)\right) = \arg\min_{\theta \in \Theta}\mathcal{L}\left(D_{b}, T\left(\cdot, \theta\right)\right)$ \\
  $\mathbf{Z}_{b} = T\left(\mathcal{D}, \hat{\theta}\left(\mathcal{D}_{b}\right)\right)$ \\
}
\end{algorithm}


%\label{alg:features}

%Feature Subspace Stability
%\label{alg:fss}
%Inputs: $B$ sets of learned features, $\left(\mathcal{Z}_{b}, \mathcal{Z}_{b}^{C}\right)_{b = 1}^{B}$. Alignment strategy $\mathcal{A}$. Selection mechanism $\mathcal{S}$.
%1. Merge learned features, 
%$for b = 1, \dots, B$
%	$\mathbf{Z}_{b}^{All} = \left[\mathbf{Z}_{b} \\ \mathbf{Z}_{b}^{C}\right]$.
%3. Align features,$M, \left(\underaccent{\bar}{\mathbf{Z}^{All}}_{1}, \dots, \underaccent{\bar}{\mathbf{Z}^{All}}_{B}\right) = \mathcal{A}\left(\mathbf{Z}^{All}_{1}, \dots, \mathbf{Z}^{All}_{B}\right)$.
%4. Compute feature subspace stability,
%\begin{align*}
%FSS_{\mathcal{A}}_\left(\mathbf{Z}^{All}_{1}, \dots, \mathbf{Z}^{All}_{B}\right) = \frac{1}{B} \sum_{b = 1}^{B} \|\underaccent{\bar}{\mathbf{Z}}^{All}_{b} - \mathbf{M}\|^{2}_{2}.
%\end{align*}*
%5. Split aligned features,
%$for b = 1, \dots, B$,
%	$\left[\underaccent{\bar}{\mathbf{Z}}_{b} \\ \underaccent{\bar}{\mathbf{Z}}_{b}^{C}\right] = \underaccent{\mathbf{Z}}_{b}^{All}$.

%Returns: Aligned features $\left(\underaccent{\bar}{\mathbf{Z}}_{1}, \dots, \underaccent{\bar}{\mathbf{Z}}_{B}\right)$. Feature subspace stability score $FSS_{\mathcal{A}}$.

% Selection Stability
%\label{alg:selection}
%Inputs: Aligned, reserved set features $\left(\underaccent{\bar}{\mathbf{Z}^{C}}_{b}\right)_{b = 1}^{B}$. Selection mechanism $\mathcal{S}$.
%1. Define $B$ selection sets, 
%$for b = 1, \dots, B$
%$S_{b} = \mathcal{S}\left(\underaccent{\bar}{\mathbf{Z}^{C}}_{b}, y\right)$
%2. For each column of the learned features, compute a selection score,
%$for k = 1, \dots, K$
%$SS_{k} = \frac{1}{B} \sum_{b = 1}^{B} \indic{k \in S_{b}}$
%Return: Selection stability scores $SS_{1}, \dots, SS_{k}$.

